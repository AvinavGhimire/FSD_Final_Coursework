{% extends 'base.twig' %}

{% block content %}
<div class="page-header">
    <h2>All Members</h2>
    <a href="/genz/public/add.php?type=member" class="btn btn-primary">Add New Member</a>
</div>

{% if members is empty %}
    <div class="alert alert-info">
        <p>No members found. <a href="/genz/public/add.php?type=member">Add your first member</a>!</p>
    </div>
{% else %}
    <div class="books-grid">
        {% for member in members %}
        <div class="book-card">
            <div class="book-header">
                <h3>{{ (member.first_name ~ ' ' ~ member.last_name)|e }}</h3>
                <span class="book-id">#{{ member.id|e }}</span>
            </div>
            <div class="book-details">
                <p><strong>Email:</strong> {{ member.email|e }}</p>
                <p><strong>Phone:</strong> {{ member.phone|e }}</p>
                <p><strong>Membership Type:</strong> <span class="badge">{{ member.membership_type|e }}</span></p>
                <p><strong>Status:</strong>
                    <span class="badge {{ member.status|lower }}">
                        {{ member.status|e }}
                    </span>
                </p>
                <p><strong>Start Date:</strong> {{ formatDate(member.membership_start_date) }}</p>
                <p><strong>Expiry Date:</strong>
                    <span class="{{ isMembershipExpired(member.membership_expiry_date) ? 'text-danger' : '' }}">
                        {{ formatDate(member.membership_expiry_date) }}
                    </span>
                </p>
                {% if member.date_of_birth %}
                <p><strong>Date of Birth:</strong> {{ formatDate(member.date_of_birth) }}</p>
                {% endif %}
            </div>
            <div class="book-actions">
                <a href="/genz/public/edit.php?type=member&id={{ member.id|e('url') }}" class="btn btn-sm btn-edit">Edit</a>
                <a href="/genz/public/delete.php?type=member&id={{ member.id|e('url') }}" class="btn btn-sm btn-delete"
                   onclick="return confirm('Are you sure you want to delete this member?');">Delete</a>
                <button type="button" onclick="validateMembership({{ member.id }})" class="btn btn-sm btn-info">Validate</button>
            </div>
        </div>
        {% endfor %}
    </div>
{% endif %}

<div id="validation-result" style="display:none; margin-top: 20px;"></div>
{% endblock %}

